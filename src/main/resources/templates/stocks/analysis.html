<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>è‚¡ç¥¨æ™ºèƒ½åˆ†æ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .filter-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .filter-title {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        .filter-title::before {
            content: "ğŸ”";
            margin-right: 10px;
            font-size: 24px;
        }

        .conditions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .condition-item {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .condition-item:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
            transform: translateY(-2px);
        }

        .condition-item input[type="checkbox"] {
            position: absolute;
            opacity: 0;
        }

        .condition-item input[type="checkbox"]:checked + label {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .condition-item label {
            display: block;
            cursor: pointer;
            padding: 10px;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .condition-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .condition-desc {
            font-size: 13px;
            color: #666;
            line-height: 1.5;
        }

        .condition-item input[type="checkbox"]:checked + label .condition-desc {
            color: rgba(255,255,255,0.9);
        }

        .condition-item input[type="date"],
        .condition-item input[type="number"] {
            font-family: inherit;
        }

        .condition-item input[type="date"]:focus,
        .condition-item input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 5px rgba(102, 126, 234, 0.3);
        }

        .search-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .search-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .search-button:active {
            transform: translateY(0);
        }

        .results-section {
            margin-top: 30px;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #667eea;
        }

        .results-title {
            font-size: 22px;
            font-weight: bold;
            color: #333;
        }

        .results-count {
            background: #667eea;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
        }

        .message {
            text-align: center;
            padding: 40px;
            color: #999;
            font-size: 16px;
        }

        .message::before {
            content: "â„¹ï¸";
            display: block;
            font-size: 48px;
            margin-bottom: 15px;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .results-table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .results-table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            white-space: nowrap;
        }

        .results-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        .results-table tbody tr {
            transition: background 0.2s ease;
        }

        .results-table tbody tr:hover {
            background: #f8f9fa;
        }

        .stock-symbol {
            font-weight: bold;
            color: #667eea;
        }

        .price {
            font-weight: bold;
            color: #333;
        }

        .drop-percentage {
            font-weight: bold;
        }

        .drop-high {
            color: #e74c3c;
        }

        .drop-medium {
            color: #f39c12;
        }

        .drop-low {
            color: #27ae60;
        }

        .condition-badge {
            display: inline-block;
            padding: 4px 10px;
            background: #e8f0fe;
            color: #1967d2;
            border-radius: 12px;
            font-size: 12px;
        }

        @media (max-width: 768px) {
            .conditions-grid {
                grid-template-columns: 1fr;
            }
            
            .results-table {
                font-size: 14px;
            }
            
            .results-table th,
            .results-table td {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š è‚¡ç¥¨æ™ºèƒ½åˆ†æç³»ç»Ÿ</h1>
            <p>åŸºäºå†å²æ•°æ®çš„å¤šç»´åº¦è‚¡ç¥¨ç­›é€‰å·¥å…·</p>
        </div>

        <div class="content">
            <!-- ç­›é€‰æ¡ä»¶åŒºåŸŸ -->
            <div class="filter-section">
                <div class="filter-title">é€‰æ‹©ç­›é€‰æ¡ä»¶</div>
                
                <form th:action="@{/stock-analysis/search}" method="get" onchange="updateParamsVisibility()">
                    <div class="conditions-grid">
                        <!-- æ¡ä»¶1: ä½äºå†å²æœ€é«˜å€¼25% -->
                        <div class="condition-item">
                            <input type="checkbox" id="cond1" name="conditions" value="below_75_percent" 
                                   th:checked="${selectedConditions != null && selectedConditions.contains('below_75_percent')}">
                            <label for="cond1">
                                <div class="condition-title">ğŸ’ è¶…è·Œæ½œåŠ›è‚¡</div>
                                <div class="condition-desc">ç­›é€‰å‡ºæ¯”å†å²æœ€é«˜å€¼ä½25%ä»¥ä¸Šçš„è‚¡ç¥¨ï¼Œå¯èƒ½å­˜åœ¨ä»·å€¼å›å½’æœºä¼š</div>
                            </label>
                        </div>

                        <!-- æ¡ä»¶1çš„å‚æ•°é…ç½® -->
                        <div class="condition-item" id="cond1-params" style="grid-column: span 2; display: none;">
                            <label style="padding: 0;">
                                <div class="condition-title" style="margin-bottom: 15px;">âš™ï¸ å‚æ•°è®¾ç½®</div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                    <div>
                                        <label style="display: block; font-size: 13px; color: #666; margin-bottom: 5px;">å¼€å§‹æ—¥æœŸï¼ˆå¯é€‰ï¼‰</label>
                                        <input type="date" name="startDate" th:value="${startDate}" 
                                               style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px;">
                                        <div style="font-size: 12px; color: #999; margin-top: 3px;">é»˜è®¤ï¼šå…¨éƒ¨å†å²æ•°æ®</div>
                                    </div>
                                    <div>
                                        <label style="display: block; font-size: 13px; color: #666; margin-bottom: 5px;">è·Œå¹…ç™¾åˆ†æ¯”ï¼ˆ%ï¼‰</label>
                                        <input type="number" name="dropPercentage" th:value="${dropPercentage}" 
                                               placeholder="é»˜è®¤25" min="1" max="99" step="1"
                                               style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px;">
                                        <div style="font-size: 12px; color: #999; margin-top: 3px;">èŒƒå›´ï¼š1-99%</div>
                                    </div>
                                </div>
                            </label>
                        </div>

                        <!-- æ¡ä»¶2: é«˜æ³¢åŠ¨ä½ä½è‚¡ -->
                        <div class="condition-item">
                            <input type="checkbox" id="cond2" name="conditions" value="high_volatility_low_price"
                                   th:checked="${selectedConditions != null && selectedConditions.contains('high_volatility_low_price')}">
                            <label for="cond2">
                                <div class="condition-title">ğŸ“ˆ é«˜æ³¢åŠ¨ä½ä½è‚¡</div>
                                <div class="condition-desc">åŠå¹´å†…è‡³å°‘3æ¬¡æ³¢åŠ¨è¶…20%ï¼Œä¸”å½“å‰å¤„äºä½ä½ï¼Œé€‚åˆæ³¢æ®µæ“ä½œ</div>
                            </label>
                        </div>

                        <!-- æ¡ä»¶3: è¿ç»­ä¸Šæ¶¨ -->
                        <div class="condition-item">
                            <input type="checkbox" id="cond3" name="conditions" value="continuous_rise"
                                   th:checked="${selectedConditions != null && selectedConditions.contains('continuous_rise')}">
                            <label for="cond3">
                                <div class="condition-title">ğŸš€ å¼ºåŠ¿ä¸Šæ¶¨è‚¡</div>
                                <div class="condition-desc">æœ€è¿‘10ä¸ªäº¤æ˜“æ—¥ä¸­æœ‰8å¤©ä¸Šæ¶¨ï¼Œè¶‹åŠ¿å¼ºåŠ²</div>
                            </label>
                        </div>

                        <!-- æ¡ä»¶4: æ¥è¿‘å¹´åº¦æœ€é«˜ç‚¹ -->
                        <div class="condition-item">
                            <input type="checkbox" id="cond4" name="conditions" value="near_year_high"
                                   th:checked="${selectedConditions != null && selectedConditions.contains('near_year_high')}">
                            <label for="cond4">
                                <div class="condition-title">â­ åˆ›æ–°é«˜æ½œåŠ›è‚¡</div>
                                <div class="condition-desc">è·ç¦»å¹´åº¦æœ€é«˜ä»·5%ä»¥å†…ï¼Œå¯èƒ½çªç ´æ–°é«˜</div>
                            </label>
                        </div>

                        <!-- æ¡ä»¶5: æˆäº¤é‡æ¿€å¢ -->
                        <div class="condition-item">
                            <input type="checkbox" id="cond5" name="conditions" value="volume_surge"
                                   th:checked="${selectedConditions != null && selectedConditions.contains('volume_surge')}">
                            <label for="cond5">
                                <div class="condition-title">ğŸ”¥ æˆäº¤é‡çˆ†å‘è‚¡</div>
                                <div class="condition-desc">æœ€æ–°æˆäº¤é‡æ˜¯30å¤©å¹³å‡é‡çš„2å€ä»¥ä¸Šï¼Œèµ„é‡‘å…³æ³¨åº¦é«˜</div>
                            </label>
                        </div>

                        <!-- æ¡ä»¶6: å‡çº¿é‡‘å‰ -->
                        <div class="condition-item">
                            <input type="checkbox" id="cond6" name="conditions" value="ma_golden_cross"
                                   th:checked="${selectedConditions != null && selectedConditions.contains('ma_golden_cross')}">
                            <label for="cond6">
                                <div class="condition-title">âœ¨ å‡çº¿é‡‘å‰è‚¡</div>
                                <div class="condition-desc">5æ—¥å‡çº¿ä¸Šç©¿10æ—¥å‡çº¿ï¼ŒæŠ€æœ¯é¢çœ‹æ¶¨ä¿¡å·</div>
                            </label>
                        </div>
                    </div>

                    <button type="submit" class="search-button">ğŸ” å¼€å§‹ç­›é€‰</button>
                </form>

                <script>
                    function updateParamsVisibility() {
                        const cond1 = document.getElementById('cond1');
                        const params = document.getElementById('cond1-params');
                        params.style.display = cond1.checked ? 'block' : 'none';
                    }
                    // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
                    document.addEventListener('DOMContentLoaded', updateParamsVisibility);
                </script>
            </div>

            <!-- ç»“æœå±•ç¤ºåŒºåŸŸ -->
            <div class="results-section" th:if="${results != null || message != null}">
                <!-- æç¤ºæ¶ˆæ¯ -->
                <div class="message" th:if="${message != null}" th:text="${message}"></div>

                <!-- ç­›é€‰ç»“æœ -->
                <div th:if="${results != null && !results.isEmpty()}">
                    <div class="results-header">
                        <div class="results-title">ç­›é€‰ç»“æœ</div>
                        <div class="results-count" th:text="'å…±æ‰¾åˆ° ' + ${resultCount} + ' åªè‚¡ç¥¨'"></div>
                    </div>

                    <table class="results-table">
                        <thead>
                            <tr>
                                <th>è‚¡ç¥¨ä»£ç </th>
                                <th>è‚¡ç¥¨åç§°</th>
                                <th>å½“å‰ä»·æ ¼</th>
                                <th>å†å²æœ€é«˜</th>
                                <th>è·Œå¹…/ä½ç½®</th>
                                <th>åŒ¹é…æ¡ä»¶</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="stock : ${results}">
                                <td class="stock-symbol" th:text="${stock.symbol}">sh600000</td>
                                <td th:text="${stock.name}">ç¤ºä¾‹è‚¡ç¥¨</td>
                                <td class="price" th:text="${stock.currentPrice != null ? 'Â¥' + #numbers.formatDecimal(stock.currentPrice, 1, 2) : '--'}">Â¥10.50</td>
                                <td th:text="${stock.historicalHigh != null ? 'Â¥' + #numbers.formatDecimal(stock.historicalHigh, 1, 2) : '--'}">Â¥15.20</td>
                                <td>
                                    <span th:if="${stock.dropPercentage != null}" 
                                          th:text="'-' + ${#numbers.formatDecimal(stock.dropPercentage, 1, 2)} + '%'"
                                          th:class="${stock.dropPercentage > 30 ? 'drop-percentage drop-high' : (stock.dropPercentage > 15 ? 'drop-percentage drop-medium' : 'drop-percentage drop-low')}">
                                        -25.5%
                                    </span>
                                    <span th:if="${stock.dropPercentage == null}">--</span>
                                </td>
                                <td>
                                    <span class="condition-badge" th:text="${stock.matchedCondition}">è¶…è·Œæ½œåŠ›è‚¡</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- æ— ç»“æœæç¤º -->
                <div class="message" th:if="${results != null && results.isEmpty()}">
                    æœªæ‰¾åˆ°ç¬¦åˆæ‰€é€‰æ¡ä»¶çš„è‚¡ç¥¨ï¼Œè¯·å°è¯•å…¶ä»–ç­›é€‰æ¡ä»¶
                </div>
            </div>
        </div>
    </div>
</body>
</html>
