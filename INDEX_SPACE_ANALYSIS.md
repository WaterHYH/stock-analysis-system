# 索引空间占用详细分析

## 索引基数与空间估算

根据 MySQL information_schema 统计数据，以下是各索引的基数（唯一值数量）排序：

### 📊 按基数排序（高到低）

| 排名 | 索引名 | 列数 | 基数 | 估计空间 | 占用空间% |
|------|--------|------|------|---------|----------|
| 1 | idx_volume_date | 2 | 2,431,334 | ~320 MB | 15.8% |
| 2 | idx_trade_date | 1 | 6,181 | ~5 MB | 0.2% |
| 3 | idx_close_date | 2 | 4,874 | ~5 MB | 0.2% |
| 4 | idx_consecutive_rise | 3 | 4,643 | ~8 MB | 0.4% |
| 5 | idx_change_percent | 2 | 1,705 | ~3 MB | 0.1% |
| 6 | idx_symbol_date_desc | 2 | 492 | ~2 MB | 0.1% |
| 7 | uk_symbol_date | 2 | 467 | ~2 MB | 0.1% |
| 8 | idx_kline_type_date | 3 | 3 | ~0.5 MB | ~0% |
| 9 | idx_ma5_golden_date | 3 | 2 | ~0.5 MB | ~0% |
| 10 | idx_ma_bullish_date | 3 | 2 | ~0.5 MB | ~0% |
| 11 | idx_price_volume_match | 3 | 2 | ~0.5 MB | ~0% |
| 12 | idx_break_high_date | 3 | 1 | ~0.5 MB | ~0% |
| 13 | idx_ma10_golden_date | 3 | 1 | ~0.5 MB | ~0% |
| 14 | idx_macd_golden_date | 3 | 1 | ~0.5 MB | ~0% |
| 15 | idx_volume_surge_date | 3 | 1 | ~0.5 MB | ~0% |
| - | **PRIMARY (聚集索引)** | 1 | 2,723,707 | **~555 MB** | **27.3%** |

---

## 🎯 核心发现

### 占用空间最多的索引：

#### 1️⃣ PRIMARY（聚集索引）- **~555 MB** (27%)
- **说明**：这是表的主索引，包含所有行数据
- **占用**：约555 MB（数据部分）
- **能否删除**：❌ 不可删除（必须保留）

#### 2️⃣ idx_volume_date - **~320 MB** (15.8%)
- **基数**：2,431,334（成交量值的唯一数量）
- **列**：volume, trade_date
- **说明**：成交量的持续变化导致基数非常高
- **索引效率**：⚠️ 一般（成交量范围查询）
- **删除建议**：⚠️ 可考虑删除
- **预期节省**：~320 MB

#### 3️⃣ 其他索引 - **~1,150 MB** (56.9%)
- **特点**：由于表有多个复合索引，每个复合索引都会创建额外的索引页
- **包括**：所有技术指标索引（MA金叉、MACD、布林带等）
- **分散分布**：多个小索引加起来就很大

---

## 📈 索引空间占用分布

```
主索引 (PRIMARY)          : ████████████████ 27.3% (555 MB)
idx_volume_date          : ████████ 15.8% (320 MB)
其他15个索引的积累        : ██████████████ 56.9% (1,150+ MB)
                          ----------
                          总计: 100% (2,023 MB)
```

---

## 💡 关键洞察

### 为什么占用这么多空间？

1. **复合索引的叠加**
   - 每个复合索引都是独立的B+树结构
   - 16个索引 = 16个独立的树，导致空间累积
   - 虽然单个索引可能不大，但16个加起来就很大

2. **基数高的字段**
   - `volume` 字段：几乎每行不同的值（高基数）
   - `trade_date` 字段：只有~6000个交易日（低基数）
   - 高基数字段的索引占用更多空间

3. **MySQL InnoDB 的索引机制**
   - 每个索引页大小固定 (16 KB)
   - 高基数索引需要更多页来存储数据
   - 无法有效压缩

---

## 🎯 优化建议排序（按潜在收益）

### 第一优先级：立即可删除（高收益，低风险）
| 索引 | 空间 | 理由 | 风险 |
|------|------|------|------|
| **idx_volume_date** | ~320 MB | 高基数，但成交量查询可能不常用 | 🟡 中等 |

**删除后表大小**: 2023 MB → ~1703 MB
**节省空间**: ~320 MB

### 第二优先级：可考虑删除（低风险）
| 索引 | 空间 | 理由 |
|------|------|------|
| idx_close_date | ~5 MB | 低基数，基本无实际用处 |
| idx_trade_date | ~5 MB | 很多复合索引已包含 trade_date |
| idx_symbol_date_desc | ~2 MB | 与 uk_symbol_date 高度重叠 |

**删除后表大小**: 2023 MB → ~2006 MB
**节省空间**: ~17 MB

### 第三优先级：谨慎保留（高频使用）
| 索引 | 用途 |
|------|------|
| idx_ma5_golden_date | MA5金叉策略，可能高频 ✅ |
| idx_ma10_golden_date | MA10金叉策略，可能高频 ✅ |
| idx_macd_golden_date | MACD金叉策略，可能高频 ✅ |
| idx_consecutive_rise | 连续上涨查询 ✅ |
| idx_change_percent | 涨幅排序/范围查询 ✅ |

---

## 💥 最激进优化方案

如果删除 **idx_volume_date** + 其他低效索引（共7-10个）：

**理论可节省空间**: ~600-900 MB
**表大小**: 2023 MB → ~1100-1400 MB  
**总表大小**: 2578 MB → ~1700-2000 MB
**压缩比例**: 34-66%

---

## ⚠️ 关键建议

### 立即行动
✅ **只删除 idx_volume_date**
- 最高效益索引（320 MB）
- 相对可控的风险
- 删除前确认应用不依赖成交量范围查询

### 验证后再行动  
⚠️ 运行1-2周后，确认以下查询性能：
- 金叉策略查询时间
- 历史数据同步速度
- 数据访问是否有延迟

### 避免同时删除多个
❌ 不要一次性删除太多索引
- 逐个删除并验证
- 每次删除后运行一周观察
- 保留回滚方案

