# stock_history è¡¨ç´¢å¼•åˆ†æžä¸Žä¼˜åŒ–æ–¹æ¡ˆ

## å½“å‰ç´¢å¼•æƒ…å†µ

### ç´¢å¼•æ€»æ•°ï¼š20 ä¸ª

| ç´¢å¼•ç±»åž‹ | æ•°é‡ | è¯´æ˜Ž |
|---------|------|------|
| ä¸»é”® (PRIMARY) | 1 | id (èšé›†ç´¢å¼•) |
| å”¯ä¸€ç´¢å¼• | 1 | uk_symbol_date (symbol+trade_date) |
| æ™®é€šç´¢å¼• | 18 | å„ç§ä¸šåŠ¡æŸ¥è¯¢ç´¢å¼• |

---

## ç´¢å¼•è¯¦ç»†åˆ†æž

### 1ï¸âƒ£ å¿…é¡»ä¿ç•™çš„ç´¢å¼•

#### PRIMARY KEY (id)
- **å ç”¨ç©ºé—´**: ~130 MB (èšé›†ç´¢å¼•ï¼Œå«æ‰€æœ‰æ•°æ®)
- **ç”¨é€”**: è¡¨çš„èšé›†ç´¢å¼•ï¼Œå­˜å‚¨æ‰€æœ‰è¡Œæ•°æ®
- **ä¼˜åŒ–åº¦**: âŒ ä¸å¯åˆ é™¤

#### uk_symbol_date (symbol + trade_date) [UNIQUE]
- **å ç”¨ç©ºé—´**: ~400 MB
- **ç”¨é€”**: 
  - ç¡®ä¿ (symbol, trade_date) ç»„åˆçš„å”¯ä¸€æ€§
  - é¿å…é‡å¤æ•°æ®
  - åŠ å¿«åŽ»é‡æŸ¥è¯¢
- **æŸ¥è¯¢åœºæ™¯**: å•æ—¥ç‰¹å®šè‚¡ç¥¨çš„åŽ†å²æŸ¥è¯¢
- **ä¼˜åŒ–åº¦**: âŒ ä¸å¯åˆ é™¤

---

### 2ï¸âƒ£ å¯ä»¥ä¼˜åŒ–çš„ç´¢å¼•

#### é«˜åº¦å†—ä½™çš„ç´¢å¼•ç»„

##### é—®é¢˜ï¼šè¿‡åº¦ç´¢å¼•
- **idx_symbol** (symbol)
- **idx_date_symbol** (trade_date, symbol)
- **idx_symbol_date_desc** (symbol, trade_date)

**åˆ†æž**ï¼š
- `uk_symbol_date` å·²ç»åŒ…å«äº† symbol + trade_date çš„ç»„åˆ
- è¿™ä¸‰ä¸ªç´¢å¼•å¯¹ä¸Šè¿°æŸ¥è¯¢æ˜¯å†—ä½™çš„
- **å»ºè®®**ï¼šåˆ é™¤ `idx_symbol` å’Œ `idx_date_symbol`ï¼Œä¿ç•™ `idx_symbol_date_desc`

**èŠ‚çœç©ºé—´**: ~100-150 MB

---

##### æ—¶é—´åºåˆ—ç´¢å¼•å†—ä½™

**å†—ä½™ç´¢å¼•å¯¹**ï¼š
1. `idx_trade_date` (trade_date)
   - ä¸Žå¤šä¸ªç»„åˆç´¢å¼•ä¸­çš„ trade_date å†—ä½™
   
2. `idx_close_date` (close, trade_date)
   - close å­—æ®µçš„ç´¢å¼•ä»·å€¼ä¸å¤§ï¼ˆæ•°æ®åˆ†æ•£ï¼‰
   
3. `idx_volume_date` (volume, trade_date)
   - volume å­—æ®µçš„ç´¢å¼•ä»·å€¼ä¸å¤§

**åˆ†æž**ï¼š
- è®¸å¤šæŠ€æœ¯æŒ‡æ ‡ç´¢å¼•å·²ç»åŒ…å«äº† trade_date
- å•ç‹¬çš„ trade_date ç´¢å¼•å¯èƒ½è¢«è¿™äº›ç»„åˆç´¢å¼•è¦†ç›–
- close å’Œ volume ä½œä¸ºç´¢å¼•çš„ç¬¬ä¸€åˆ—ï¼Œæ•ˆçŽ‡ä¸é«˜

**å»ºè®®**ï¼š
- è¯„ä¼° `idx_close_date` å’Œ `idx_volume_date` çš„å®žé™…ä½¿ç”¨æƒ…å†µ
- å¦‚æžœ close å’Œ volume æŸ¥è¯¢ä¸é¢‘ç¹ï¼Œå¯ä»¥åˆ é™¤

**èŠ‚çœç©ºé—´**: ~150-200 MB

---

### 3ï¸âƒ£ æŠ€æœ¯æŒ‡æ ‡ç´¢å¼•åˆ†æž

#### é‡‘å‰æ­»å‰ç›¸å…³ç´¢å¼•ï¼ˆå¯ä¿ç•™ï¼Œä½¿ç”¨é¢‘çŽ‡é«˜ï¼‰
- `idx_ma5_golden_date` (is_ma5_golden_cross, trade_date, symbol)
- `idx_ma10_golden_date` (is_ma10_golden_cross, trade_date, symbol)
- `idx_macd_golden_date` (is_macd_golden_cross, symbol, trade_date)

**ç”¨é€”**: é‡‘å‰ç­–ç•¥æŸ¥è¯¢ï¼Œä½¿ç”¨é¢‘çŽ‡ ðŸ”´ å¾ˆé«˜
**ä¼˜åŒ–åº¦**: âœ… ä¿ç•™

#### è¶…ä¹°è¶…å–ç›¸å…³ç´¢å¼•ï¼ˆå¯ä¼˜åŒ–ï¼‰
- `idx_overbought_date` (is_overbought, trade_date, symbol)
- `idx_oversold_date` (is_oversold, trade_date, symbol)

**é—®é¢˜**ï¼š
- is_overbought å’Œ is_oversold æ˜¯å¸ƒå°”å€¼ï¼Œåªæœ‰ 2 ä¸ªå€¼ï¼ˆ0/1ï¼‰
- è¿™æ ·çš„ä½ŽåŸºæ•°å­—æ®µä½œä¸ºç´¢å¼•çš„ç¬¬ä¸€åˆ—ï¼Œæ•ˆçŽ‡æžä½Ž
- æ•°æ®åº“ä¼šæ‰«æå¤§é‡ä¸ç›¸å…³çš„è¡Œ

**å»ºè®®**ï¼š
- è€ƒè™‘åˆ é™¤è¿™ä¸¤ä¸ªç´¢å¼•
- å¦‚æžœéœ€è¦æŸ¥è¯¢è¶…ä¹°è¶…å–è‚¡ç¥¨ï¼Œæ”¹ä¸ºå…¨è¡¨æ‰«ææ€§èƒ½å¯èƒ½æ›´å¥½

**èŠ‚çœç©ºé—´**: ~100-150 MB

---

#### å…¶ä»–æŠ€æœ¯æŒ‡æ ‡ç´¢å¼•
- `idx_ma_bullish_date` (is_ma_bullish, trade_date, symbol)
- `idx_volume_surge_date` (is_volume_surge, trade_date, symbol)
- `idx_price_volume_match` (is_price_volume_match, trade_date, symbol)
- `idx_break_high_date` (is_break_high, trade_date, symbol)

**é—®é¢˜**ï¼š
- åŒæ ·éƒ½æ˜¯å¸ƒå°”å€¼å­—æ®µä½œä¸ºç¬¬ä¸€åˆ—
- æŸ¥è¯¢æ•ˆçŽ‡ä¸ç†æƒ³

**å»ºè®®**ï¼š
- å¦‚æžœè¿™äº›å­—æ®µæŸ¥è¯¢é¢‘çŽ‡ä¸é«˜ï¼Œå¯ä»¥åˆ é™¤
- å¦‚æžœå¿…é¡»ä¿ç•™ï¼Œé‡æ–°è®¾è®¡ç´¢å¼•ï¼š(trade_date, symbol) å¯èƒ½æ›´é«˜æ•ˆ

**èŠ‚çœç©ºé—´**: ~200-300 MB

---

#### å…¶ä»–å¤åˆç´¢å¼•
- `idx_kline_type_date` (kline_type, trade_date, symbol)
- `idx_change_percent` (change_percent, trade_date)
- `idx_consecutive_rise` (consecutive_rise_days, trade_date, symbol)

**åˆ†æž**ï¼š
- kline_type åªæœ‰ 3 ä¸ªå€¼ï¼Œä½ŽåŸºæ•°
- change_percent æ˜¯è¿žç»­å€¼ï¼Œä½†é€šå¸¸ç”¨äºŽèŒƒå›´æŸ¥è¯¢
- consecutive_rise_days æ˜¯è¿žç»­å€¼

**å»ºè®®**ï¼š
- `idx_kline_type_date`: åˆ é™¤ï¼Œæ”¹ä¸º (trade_date, symbol) æŸ¥è¯¢
- `idx_change_percent`: å¦‚æžœæœ‰ >= / <= æŸ¥è¯¢éœ€æ±‚ï¼Œä¿ç•™
- `idx_consecutive_rise`: å¦‚æžœæœ‰èŒƒå›´æŸ¥è¯¢éœ€æ±‚ï¼Œå¯ä¿ç•™

**èŠ‚çœç©ºé—´**: ~150-200 MB

---

## ä¼˜åŒ–æ–¹æ¡ˆæ±‡æ€»

### ðŸŸ¢ ç¬¬ä¸€é˜¶æ®µï¼šç«‹å³åˆ é™¤ï¼ˆé£Žé™©ä½Žï¼‰

| ç´¢å¼•å | åŽŸå›  | èŠ‚çœç©ºé—´ |
|--------|------|---------|
| `idx_symbol` | è¢« uk_symbol_date å®Œå…¨è¦†ç›– | ~50 MB |
| `idx_date_symbol` | è¢« uk_symbol_date å®Œå…¨è¦†ç›– | ~70 MB |
| `idx_overbought_date` | ä½ŽåŸºæ•°å­—æ®µï¼ŒæŸ¥è¯¢æ•ˆçŽ‡å·® | ~100 MB |
| `idx_oversold_date` | ä½ŽåŸºæ•°å­—æ®µï¼ŒæŸ¥è¯¢æ•ˆçŽ‡å·® | ~100 MB |

**åˆè®¡èŠ‚çœ**: ~320 MB

---

### ðŸŸ¡ ç¬¬äºŒé˜¶æ®µï¼šæŒ‰éœ€åˆ é™¤ï¼ˆéœ€éªŒè¯ä¸šåŠ¡æŸ¥è¯¢ï¼‰

| ç´¢å¼•å | éœ€è¦éªŒè¯çš„åœºæ™¯ | èŠ‚çœç©ºé—´ |
|--------|---------------|---------|
| `idx_close_date` | close ä»·æ ¼èŒƒå›´æŸ¥è¯¢çš„ä½¿ç”¨é¢‘çŽ‡ | ~80 MB |
| `idx_volume_date` | æˆäº¤é‡èŒƒå›´æŸ¥è¯¢çš„ä½¿ç”¨é¢‘çŽ‡ | ~80 MB |
| `idx_ma_bullish_date` | å‡çº¿å¤šå¤´æŽ’åˆ—æŸ¥è¯¢é¢‘çŽ‡ | ~90 MB |
| `idx_volume_surge_date` | æ”¾é‡æŸ¥è¯¢é¢‘çŽ‡ | ~90 MB |
| `idx_price_volume_match` | é‡ä»·åŒ¹é…æŸ¥è¯¢é¢‘çŽ‡ | ~90 MB |
| `idx_break_high_date` | çªç ´é«˜ç‚¹æŸ¥è¯¢é¢‘çŽ‡ | ~90 MB |
| `idx_kline_type_date` | Kçº¿ç±»åž‹æŸ¥è¯¢é¢‘çŽ‡ | ~80 MB |

**åˆè®¡èŠ‚çœ**: ~600 MB (éœ€éªŒè¯åŽ)

---

### ðŸŸ  ç¬¬ä¸‰é˜¶æ®µï¼šè°¨æ…Žä¿ç•™

| ç´¢å¼•å | ä¿ç•™åŽŸå›  |
|--------|---------|
| `idx_ma5_golden_date` | é‡‘å‰ç­–ç•¥ï¼Œé«˜é¢‘æŸ¥è¯¢ âœ… |
| `idx_ma10_golden_date` | é‡‘å‰ç­–ç•¥ï¼Œé«˜é¢‘æŸ¥è¯¢ âœ… |
| `idx_macd_golden_date` | MACD é‡‘å‰ï¼Œé«˜é¢‘æŸ¥è¯¢ âœ… |
| `idx_trade_date` | æ—¶é—´èŒƒå›´æŸ¥è¯¢å¸¸ç”¨ âœ… |
| `idx_change_percent` | æ¶¨å¹…æŽ’åº/èŒƒå›´æŸ¥è¯¢ âœ… |
| `idx_consecutive_rise` | è¿žç»­ä¸Šæ¶¨æŸ¥è¯¢ âœ… |
| `PRIMARY` | å¿…é¡» âœ… |
| `uk_symbol_date` | å¿…é¡»ï¼Œç¡®ä¿æ•°æ®å”¯ä¸€æ€§ âœ… |
| `idx_symbol_date_desc` | æ—¶åºæŸ¥è¯¢ä¼˜åŒ– âœ… |

---

## é¢„æœŸä¼˜åŒ–æ•ˆæžœ

### åœºæ™¯ 1ï¼šä»…åˆ é™¤æ˜Žæ˜¾å†—ä½™çš„ç´¢å¼•
- **åˆ é™¤**: idx_symbol, idx_date_symbol
- **èŠ‚çœç©ºé—´**: ~120 MB
- **è¡¨å¤§å°**: 2578.55 MB â†’ ~2458 MB
- **é£Žé™©**: ðŸŸ¢ ä½Ž

### åœºæ™¯ 2ï¼šåˆ é™¤ä½Žæ•ˆçŽ‡çš„å¸ƒå°”ç´¢å¼•
- **åˆ é™¤**: idx_symbol, idx_date_symbol, idx_overbought_date, idx_oversold_date
- **èŠ‚çœç©ºé—´**: ~320 MB
- **è¡¨å¤§å°**: 2578.55 MB â†’ ~2258 MB
- **é£Žé™©**: ðŸŸ¡ ä¸­ï¼ˆéœ€éªŒè¯æ˜¯å¦æœ‰æŸ¥è¯¢ä¾èµ–ï¼‰

### åœºæ™¯ 3ï¼šæ¿€è¿›ä¼˜åŒ–ï¼ˆéœ€éªŒè¯æ‰€æœ‰ä¸šåŠ¡æŸ¥è¯¢ï¼‰
- **åˆ é™¤**: 7-10 ä¸ªä½Žæ•ˆç´¢å¼•
- **èŠ‚çœç©ºé—´**: ~600-900 MB
- **è¡¨å¤§å°**: 2578.55 MB â†’ ~1600-1900 MB
- **é£Žé™©**: ðŸ”´ é«˜ï¼ˆéœ€å…¨é¢æµ‹è¯•ï¼‰

---

## ä¼˜åŒ–å»ºè®®æ­¥éª¤

### âœ… Step 1ï¼šåŸºç¡€åˆ†æžï¼ˆçŽ°åœ¨ï¼‰
```sql
-- æ£€æŸ¥å“ªäº›ç´¢å¼•ä»Žæœªè¢«ä½¿ç”¨è¿‡
SELECT object_schema, object_name, count_read, count_write
FROM performance_schema.table_io_waits_summary_by_index_usage
WHERE object_schema = 'stock_db' AND object_name = 'stock_history'
AND count_read = 0
ORDER BY count_read;
```

### âœ… Step 2ï¼šé€‰æ‹©æ€§åˆ é™¤ï¼ˆæœ€å®‰å…¨ï¼‰
```sql
-- ä»…åˆ é™¤æ˜Žæ˜¾çš„å†—ä½™ç´¢å¼•
DROP INDEX idx_symbol ON stock_history;
DROP INDEX idx_date_symbol ON stock_history;
```

### âœ… Step 3ï¼šéªŒè¯åº”ç”¨æ€§èƒ½
- è¿è¡Œæ€§èƒ½æµ‹è¯•
- ç›‘æŽ§æŸ¥è¯¢è€—æ—¶
- æ£€æŸ¥æ˜¯å¦æœ‰æŸ¥è¯¢å˜æ…¢

### âœ… Step 4ï¼šæŒ‰éœ€åˆ é™¤æ›´å¤šç´¢å¼•
- é€æ­¥åˆ é™¤å…¶ä»–ä½Žæ•ˆç´¢å¼•
- æ¯æ¬¡åˆ é™¤åŽè¿›è¡Œæ€§èƒ½æµ‹è¯•

---

## æ³¨æ„äº‹é¡¹

### âš ï¸ é‡è¦æç¤º
1. **å¤‡ä»½ç¬¬ä¸€**: åˆ é™¤ç´¢å¼•å‰ï¼ŒåŠ¡å¿…å¤‡ä»½æ•°æ®åº“
2. **é€‰æ‹©ä½Žå³°æœŸ**: åœ¨ä¸šåŠ¡ä½Žå³°æœŸæ‰§è¡Œåˆ é™¤æ“ä½œ
3. **é€æ­¥è¿›è¡Œ**: ä¸è¦ä¸€æ¬¡æ€§åˆ é™¤æ‰€æœ‰ç´¢å¼•
4. **ç›‘æŽ§æ€§èƒ½**: åˆ é™¤åŽæŒç»­ç›‘æŽ§åº”ç”¨æ€§èƒ½
5. **æ€§èƒ½åŸºå‡†**: è®°å½•åˆ é™¤å‰çš„æŸ¥è¯¢æ€§èƒ½ï¼Œä½œä¸ºå¯¹æ¯”åŸºå‡†

### ðŸ’¡ ç´¢å¼•è®¾è®¡å»ºè®®
1. **å¸ƒå°”å­—æ®µä¸åº”ä½œä¸ºç´¢å¼•é¦–åˆ—** - åŸºæ•°å¤ªä½Žï¼Œæ•ˆçŽ‡å·®
2. **ä½¿ç”¨å¤åˆç´¢å¼•** - è€Œä¸æ˜¯å•åˆ—ç´¢å¼•ç»„åˆ
3. **trade_date åº”è¯¥ä¼˜å…ˆè€ƒè™‘** - æ—¶é—´åºåˆ—æŸ¥è¯¢æœ€å¸¸è§
4. **symbol åº”è¯¥ä¼˜å…ˆè€ƒè™‘** - ç‰¹å®šè‚¡ç¥¨æŸ¥è¯¢æœ€å¸¸è§
5. **å®šæœŸæ¸…ç†æœªä½¿ç”¨ç´¢å¼•** - å‘¨æœŸæ€§ç»´æŠ¤è¡¨ç»“æž„

